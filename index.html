<!-- index.html -->
<html>
  <head>
    <!-- Do _not_  rely on this URL in production. Use only during development.  -->
    <script src="https://netflix.github.io/falcor/build/falcor.browser.js"></script>
    <!-- For production use. -->
    <!-- <script src="https://cdn.jsdelivr.net/falcor/{VERSION}/falcor.browser.min.js"></script> -->
    <script>
      var $ref = falcor.Model.ref;
      var model = new falcor.Model({
        source: new falcor.HttpDataSource('/model.json') 
      });

      // var $ref = falcor.Model.ref;
      // var model = new falcor.Model({
      //   cache: {
      //       productsById: {
      //            1: {
      //                name: "Product ABC",
      //                otherAdd: "something 1"
      //            },
      //            2: {
      //                name: "Product 123",
      //                otherAdd: "something 2"
      //            },

      //       },
      //       _view: [ $ref('productsById[1]') ],
      //       _cart: []
      //   }
      // });


      var newProduct = {
          name: "KAMIL Product ABC DZIALA",
          otherAdd: "KAMIL something 1"
      };

      model.
        getValue("_view[123].name").
        then(function(response1) { 
          console.log("--- response1 --- ");
          console.log( response1 );
          console.log("*** response1 *** ");
          model.
            setValue("productsById[999]", newProduct).
            subscribe(function(response2){  
              console.log("test1 ", response2 );
              model.
                getValue("productsById[3]", newProduct).
                subscribe(function(response3){
                  console.log("response3", response3);
                  var newProductRef = $ref('productsById[3]');
                  model.
                    setValue("_view[3]", newProductRef).
                    subscribe(function(response4){
                      model.
                        getValue("_view[3].name").
                        then(function(response5) { 
                          console.log("DZIALA", response5 );
                        });
                    });
                });
            });
        });
    </script>
  </head>
  <body>
  </body>
</html>